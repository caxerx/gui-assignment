<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Reset Password - Library System</title>
</head>

<body>
    <div id="app">
        <v-app id="inspire">
            <v-content class="primary">
                <v-container fluid fill-height>
                    <v-layout align-center justify-center>
                        <v-flex xs12 sm8 md4>
                            <v-container style="max-width: 500px;">
                                <v-layout column justify-center align-center>
                                    <p class=" font-weight-thin display-3 white--text text-xs-center">Library System</p>
                                </v-layout>

                                <!--Login-->
                                <v-slide-x-transition leave-absolute hide-on-leave>
                                    <v-card class="elevation-12" v-if="!resetPassword">
                                        <v-container class="px-5">
                                            <p class="headline text-xs-center primary--text">Reset Your Password</p>
                                            <p class="text-xs-justify grey--text">
                                                Since this is the first time you are logging into the system, you are required to reset your password.
                                            </p>
                                            <v-form @submit.prevent="login" ref="loginForm" v-model="valid" lazy-validation>
                                                <v-text-field id="password" name="password" label="Password" type="password" v-model="loginInfo.Password" autocomplete="current-password" required :rules="passwordRules" persistent-hint hint="At least 8 characters, including number and letter." loading>
                                                    <v-progress-linear slot="progress" :color="color" height="5" :value="passwordScorePercentage"></v-progress-linear>
                                                </v-text-field>
                                                <br/>
                                                <v-text-field id="password" name="password" label="Confirm Password" type="password" v-model="loginInfo.RePassword" autocomplete="current-password" required :rules="passwordRules"></v-text-field>
                                            </v-form>
                                            <v-flex>
                                                <v-expansion-panel v-model="loginFailed" class="elevation-0">
                                                    <v-expansion-panel-content>
                                                        <v-card flat color="red lighten-2" class="white--text">
                                                            <v-card-text>
                                                                Login Failed
                                                            </v-card-text>
                                                        </v-card>
                                                    </v-expansion-panel-content>
                                                </v-expansion-panel>
                                            </v-flex>
                                            <v-layout class="align-center justify-center mt-3">
                                                <v-btn depressed color="primary" type="submit" @click="snack">Change Password</v-btn>
                                            </v-layout>
                                        </v-container>
                                    </v-card>
                                </v-slide-x-transition>

                            </v-container>
                        </v-flex>
                    </v-layout>
                </v-container>
            </v-content>
            <!-- Login page end -->
        </v-app>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>
<script>
    new Vue({
        el: '#app',
        data: () => ({
            resetPassword: false,
            loginFailed: -1,
            valid: true,
            loginInfo: { //Object reserved to submit login request
                Password: '',
                RePassword: ''
            },
            emailRules: [
                v => /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(v) || 'Invalid Email format'
            ],
            passwordRules: [
                v => !!v || 'Password is required'
            ],
            userIdRules: [v => !!v || "User ID is required"],
        }),
        methods: {
            snack() {
                if (this.$refs.loginForm.validate()) {
                    this.loginFailed = 0;
                }
            }
        },
        computed: {
            passwordScore() {
                let s = 0;
                let pw = this.loginInfo.Password;
                if (pw.length > 8) {
                    s++
                }
                if (/.*\d+.*/.test(pw)) {
                    s++;
                }
                if (/.*[a-z]+.*/.test(pw)) {
                    s++;
                }
                if (/.*[A-Z]+.*/.test(pw)) {
                    s++;
                }
                if (/.*[!@#$%^&*()\[\]"'?\/><.,`~\-=]+.*/.test(pw)) {
                    s++;
                }
                return s;
            },
            passwordScorePercentage() {
                return (this.passwordScore / 5) * 100
            },
            color() {
                if (this.passwordScore == 0) {
                    return 'grey'
                }
                if (this.passwordScore <= 3) {
                    return 'error';
                }
                if (this.passwordScore <= 4) {
                    return 'warning';
                }
                if (this.passwordScore <= 5) {
                    return 'success';
                }
            }
        }
    })
</script>

</html>